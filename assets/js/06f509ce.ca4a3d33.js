"use strict";(self.webpackChunkdeveloper_playcanvas_com=self.webpackChunkdeveloper_playcanvas_com||[]).push([[7247],{28255:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>t,metadata:()=>o,toc:()=>d});var s=n(85893),a=n(11151);const t={title:"Layers",sidebar_position:4},i=void 0,o={id:"user-manual/graphics/layers/index",title:"Layers",description:"Layers Overview",source:"@site/docs/user-manual/graphics/layers/index.md",sourceDirName:"user-manual/graphics/layers",slug:"/user-manual/graphics/layers/",permalink:"/user-manual/graphics/layers/",draft:!1,unlisted:!1,editUrl:"https://github.com/playcanvas/developer.playcanvas.com/tree/dev/docs/user-manual/graphics/layers/index.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"Layers",sidebar_position:4},sidebar:"userManualSidebar",previous:{title:"3D Gaussian Splatting",permalink:"/user-manual/graphics/gaussian-splatting"},next:{title:"Particles",permalink:"/user-manual/graphics/particles"}},l={},d=[{value:"Layers Overview",id:"layers-overview",level:2},{value:"Rendering Order",id:"rendering-order",level:2},{value:"Camera Priority",id:"camera-priority",level:3},{value:"Layer Composition",id:"layer-composition",level:3},{value:"Sort Modes",id:"sort-modes",level:3},{value:"Default Layers",id:"default-layers",level:2},{value:"Using Custom Layers",id:"using-custom-layers",level:2},{value:"Create a layer",id:"create-a-layer",level:3},{value:"Setting the sort mode",id:"setting-the-sort-mode",level:3},{value:"Choosing the layer order",id:"choosing-the-layer-order",level:3},{value:"Rendering entities in layers",id:"rendering-entities-in-layers",level:3},{value:"Recommended setup",id:"recommended-setup",level:3}];function h(e){const r={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,a.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h2,{id:"layers-overview",children:"Layers Overview"}),"\n",(0,s.jsx)(r.p,{children:"Layers allow you to customize the render loop for your application. Using layers you can implement some advanced rendering features. For example:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"modify the order in which your meshes are rendered"}),"\n",(0,s.jsx)(r.li,{children:"set cameras to render only some meshes"}),"\n",(0,s.jsx)(r.li,{children:"set which lights affect which meshes"}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"A PlayCanvas application is created with a default set of layers which are always present. You can create your own layers and re-order them to suit your particular requirements."}),"\n",(0,s.jsx)(r.p,{children:"At a fundamental level a layer is list of meshes to render. Each layer is divided into two sub-layers: Opaque and Transparent. When a mesh is added to a layer the layer stores it in one of the two sub-layers, depending on whether the material on the mesh needs to render transparently or not. This is because transparent sub-layers are often sorted differently than opaque sub-layers."}),"\n",(0,s.jsx)(r.h2,{id:"rendering-order",children:"Rendering Order"}),"\n",(0,s.jsx)(r.p,{children:"There are three factors that determine the order in which meshes are rendered."}),"\n",(0,s.jsx)(r.h3,{id:"camera-priority",children:"Camera Priority"}),"\n",(0,s.jsx)(r.p,{children:"Priority of the camera is the main factor that controls the order in which the meshes are rendered. Each camera has a priority assigned to it, and cameras with smaller values for priority are rendered first."}),"\n",(0,s.jsx)(r.p,{children:"Each camera also has a list of layers set up on it, which controls which layers the camera renders. Their order is described in the next section."}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{src:"/images/user-manual/graphics/layers/camera-layers.jpg",alt:"Camera Layers"})}),"\n",(0,s.jsx)(r.h3,{id:"layer-composition",children:"Layer Composition"}),"\n",(0,s.jsxs)(r.p,{children:["Next is order of layers in the application. Each application contains a ",(0,s.jsx)(r.code,{children:"pc.LayerComposition"})," object which is available in your application as ",(0,s.jsx)(r.code,{children:"this.app.scene.layers"}),". The layer composition determines the order of all sub-layers. The ordering is based on the sub-layer not on the layer so that you can, for example, render all the opaque sub-layers first, then all the transparent sub-layers afterwards."]}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Note"}),": Putting a model component inside a layer that is rendered after the world layer ",(0,s.jsx)(r.strong,{children:"will not"})," make the model render on top of everything in the world layer! The Standard Material used to render models has a property called ",(0,s.jsx)(r.code,{children:"depthTest"}),". When this is true (the default) before each pixel of the model is rendered the GPU will test to see if there is something else in front if this pixel. Even if that pixel was drawn in an earlier layer depth test ensures that only visible pixels are drawn. If you wish to ignore the distance from the camera when rendering a mesh, disable ",(0,s.jsx)(r.code,{children:"depthTest"})," in your material."]}),"\n",(0,s.jsx)(r.h3,{id:"sort-modes",children:"Sort Modes"}),"\n",(0,s.jsx)(r.p,{children:"Each sub-layer has a sort mode. Every frame the meshes in a sub-layer are sorted according to its sort mode. This determines the order that the meshes are rendered in when the sub-layer is rendered."}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Material / Mesh"})," (",(0,s.jsx)(r.code,{children:"pc.SORTMODE_MATERIALMESH"}),") - This is the default mode for opaque sub-layers. Mesh instances are sorted to minimize switching between materials and meshes to improve rendering performance."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Back-to-front"})," (",(0,s.jsx)(r.code,{children:"pc.SORTMODE_BACK2FRONT"}),") - This is the default mode for transparent sub-layers. Mesh instances are sorted back to front. This is the way to properly render many semi-transparent objects on different depth, one is blended on top of another."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Front-to-back"})," (",(0,s.jsx)(r.code,{children:"pc.SORTMODE_FRONT2BACK"}),") - Mesh instances are sorted front to back. Depending on GPU and the scene, this option may give better performance than ",(0,s.jsx)(r.code,{children:"pc.SORTMODE_MATERIALMESH"})," due to reduced overdraw."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Manual"})," (",(0,s.jsx)(r.code,{children:"pc.SORTMODE_MANUAL"}),") - This is the default mode for UI or 2D layers. Mesh instances are sorted based on ",(0,s.jsx)(r.code,{children:"drawOrder"})," property. The Element Component and Sprite Component should be placed in layers with this sort mode."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"None"})," (",(0,s.jsx)(r.code,{children:"pc.SORTMODE_NONE"}),") - No sorting is applied. Mesh instances are rendered in the same order they were added to a layer."]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"default-layers",children:"Default Layers"}),"\n",(0,s.jsx)(r.p,{children:"PlayCanvas applications are created with a set of default layers. You should leave these layers in place as some engine features will not function correctly if they are not present. They default order is below:"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{src:"/images/user-manual/graphics/layers/default-layers.jpg",alt:"Default Layers"})}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"World (Opaque)"})," - Used to render components that are not transparent and most opaque component meshes."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Depth (Opaque)"})," - Used to capture the color or the depth buffer of the scene, see ",(0,s.jsx)(r.a,{href:"/user-manual/graphics/cameras/depth-layer",children:"Depth Layer"}),"."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Skybox (Opaque)"})," - Used to render the skybox. It is rendered after the World (Opaque) to reduce overdraw."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"World (Transparent)"})," - Used to render components that are transparent and other transparent component meshes."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Immediate (Opaque)"})," - Used to render immediate mode meshes. e.g. ",(0,s.jsx)(r.code,{children:"app.renderLine()"}),"."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Immediate (Transparent)"})," - Used to render immediate mode meshes. e.g. ",(0,s.jsx)(r.code,{children:"app.renderLine()"}),"."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"UI (Transparent)"})," - Used to render Element components. All Element components are transparent, so the Opaque sub-layer is not used."]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"using-custom-layers",children:"Using Custom Layers"}),"\n",(0,s.jsx)(r.p,{children:"The default layers are great for implementing the existing engine features but the real power comes from creating your own layers to customize the order in which your content is rendered."}),"\n",(0,s.jsx)(r.h3,{id:"create-a-layer",children:"Create a layer"}),"\n",(0,s.jsxs)(r.p,{children:["Layers are controlled from the ",(0,s.jsx)(r.strong,{children:"LAYERS"})," panel in the ",(0,s.jsx)(r.strong,{children:"Settings"})," section of the Editor."]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{src:"/images/user-manual/graphics/layers/new-layer.jpg",alt:"Creating a layer"})}),"\n",(0,s.jsxs)(r.p,{children:["In the Layers section, type in the name of the layer that you wish to create and click ",(0,s.jsx)(r.strong,{children:"Add Layer"}),". Your new layer will appear in the list of available layers below the button."]}),"\n",(0,s.jsx)(r.h3,{id:"setting-the-sort-mode",children:"Setting the sort mode"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{src:"/images/user-manual/graphics/layers/edit-layer.jpg",alt:"Edit a layer"})}),"\n",(0,s.jsx)(r.p,{children:"You can choose the sort mode for each sub-layer in the layer list. Expand your layer and choose the sort mode from the dropdown menu."}),"\n",(0,s.jsx)(r.h3,{id:"choosing-the-layer-order",children:"Choosing the layer order"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{src:"/images/user-manual/graphics/layers/add-sub-layer.jpg",alt:"Add layer"})}),"\n",(0,s.jsxs)(r.p,{children:["Add a sub-layer to the layer composition by selecting ",(0,s.jsx)(r.strong,{children:"ADD SUBLAYER"})," and choosing which sub-layer you wish to add. Once your layer is in the Render Order list you can re-arrange the order by dragging each sub-layer up and down."]}),"\n",(0,s.jsx)(r.h3,{id:"rendering-entities-in-layers",children:"Rendering entities in layers"}),"\n",(0,s.jsxs)(r.p,{children:["Components that render meshes all have a ",(0,s.jsx)(r.code,{children:"layers"})," property which is used to determine which layer and sub-layer the mesh should be added to. These components include: Model, Element, Sprite, Particle System. The Camera and Light components also have a ",(0,s.jsx)(r.code,{children:"layers"})," property to determine which layers they render and light respectively."]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{src:"/images/user-manual/graphics/layers/test-layer-components.jpg",alt:"Layer Components"})}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.em,{children:"Note:"})," The model is assigned to the Test Layer. In order for it to be rendered, the camera must include Test Layer in its layer list. In order for it to be lit, the light must include Test Layer in its layer list too."]}),"\n",(0,s.jsx)(r.h3,{id:"recommended-setup",children:"Recommended setup"}),"\n",(0,s.jsx)(r.p,{children:"Your scene typically contains many entities, which render meshes. It is recommended for each of these to be on exactly one layer. In most cases, these would be on the World layer, but for more control, you can assign them to layers such as Terrain, Buildings, Characters."}),"\n",(0,s.jsx)(r.p,{children:"A new scene by default contains a single camera, and this is all that is needed in many applications. Additional cameras are useful for cases such as cutting between different cameras in the scene, or when rendering picture in picture or split screen, or when rendering the scene into a texture."}),"\n",(0,s.jsx)(r.p,{children:"When you add an additional camera, these are the recommended steps:"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsx)(r.li,{children:"Set the priority of new and existing cameras to control the order in which they render."}),"\n",(0,s.jsx)(r.li,{children:"Set up the layers of the newly created camera to specify which layers it renders. For example you might render a top down map camera and only want Terrain and Building layers in it, but not Characters."}),"\n",(0,s.jsxs)(r.li,{children:["If your camera renders into a texture, use a script to assign a render target to the ",(0,s.jsx)(r.code,{children:"renderTarget"})," property of the camera."]}),"\n"]})]})}function c(e={}){const{wrapper:r}={...(0,a.a)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},11151:(e,r,n)=>{n.d(r,{Z:()=>o,a:()=>i});var s=n(67294);const a={},t=s.createContext(a);function i(e){const r=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(t.Provider,{value:r},e.children)}}}]);