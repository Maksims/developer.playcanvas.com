"use strict";(self.webpackChunkdeveloper_playcanvas_com=self.webpackChunkdeveloper_playcanvas_com||[]).push([[2461],{36537:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>o,contentTitle:()=>r,default:()=>g,frontMatter:()=>s,metadata:()=>l,toc:()=>h});var t=n(85893),a=n(11151);const s={title:"Lightmapping",sidebar_position:3},r=void 0,l={id:"user-manual/graphics/lighting/lightmapping",title:"Lightmapping",description:"PlayCanvas Lightmapping",source:"@site/docs/user-manual/graphics/lighting/lightmapping.md",sourceDirName:"user-manual/graphics/lighting",slug:"/user-manual/graphics/lighting/lightmapping",permalink:"/user-manual/graphics/lighting/lightmapping",draft:!1,unlisted:!1,editUrl:"https://github.com/playcanvas/developer.playcanvas.com/tree/dev/docs/user-manual/graphics/lighting/lightmapping.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Lightmapping",sidebar_position:3},sidebar:"userManualSidebar",previous:{title:"Shadows",permalink:"/user-manual/graphics/lighting/shadows"},next:{title:"Ambient Occlusion",permalink:"/user-manual/graphics/lighting/ambient-occlusion"}},o={},h=[{value:"Overview",id:"overview",level:2},{value:"External Lightmap Generation",id:"external-lightmap-generation",level:2},{value:"Tools",id:"tools",level:2},{value:"Gamma Correction",id:"gamma-correction",level:2},{value:"UV Mapping",id:"uv-mapping",level:2},{value:"Simple Geometry",id:"simple-geometry",level:3},{value:"Consistent Texel Size",id:"consistent-texel-size",level:3},{value:"Non-overlapping UV",id:"non-overlapping-uv",level:3},{value:"Other Tips",id:"other-tips",level:2},{value:"Render To Texture",id:"render-to-texture",level:2},{value:"Noise",id:"noise",level:2},{value:"Upload to Editor",id:"upload-to-editor",level:2},{value:"Final remarks",id:"final-remarks",level:2}];function p(e){const i={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",...(0,a.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.a,{href:"https://playcanv.as/p/zdkARz26/",children:(0,t.jsx)(i.img,{src:"/images/user-manual/graphics/lighting/lightmapping/playcanvas-lightmapping-scene.jpg",alt:"PlayCanvas Lightmapping"})}),"\n",(0,t.jsx)(i.em,{children:"The lighting in this scene is implemented using Lightmap and AO textures and Box Projected IBL (reflections)"})]}),"\n",(0,t.jsxs)(i.p,{children:["Here is the link to ",(0,t.jsx)(i.a,{href:"https://playcanv.as/p/zdkARz26/",children:"final scene"})," and ",(0,t.jsx)(i.a,{href:"https://playcanvas.com/project/446587/overview/archviz-example",children:"project"})," that uses these techniques to achieve results in image above: External HDR Lightmaps (described in this page below), ",(0,t.jsx)(i.a,{href:"/user-manual/graphics/lighting/ambient-occlusion/",children:"Ambient Occlusion"})," and HDR Cubemap applied using Box Projection using ",(0,t.jsx)(i.a,{href:"/user-manual/graphics/physical-rendering/image-based-lighting/",children:"Image Based Lighting"})," technique to achieve realistic reflections."]}),"\n",(0,t.jsx)(i.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(i.p,{children:"Lightmap generation is the process of pre-calculating lighting information for a static scene and storing it in textures which are then applied on materials. This is an efficient way of lighting a scene if many of the light sources and geometry are static or environmental."}),"\n",(0,t.jsxs)(i.p,{children:["PlayCanvas offers two ways to use lightmaps in your scene: ",(0,t.jsx)(i.strong,{children:"External lightmap generation"})," using a 3rd-party tool and ",(0,t.jsx)(i.a,{href:"/user-manual/graphics/lighting/runtime-lightmaps/",children:(0,t.jsx)(i.strong,{children:"Runtime Lightmapping"})})," that can be generated automatically by the Engine on loading or later while application is running."]}),"\n",(0,t.jsx)(i.p,{children:"This page gives details and best practices on rendering lightmaps from external tools."}),"\n",(0,t.jsx)(i.h2,{id:"external-lightmap-generation",children:"External Lightmap Generation"}),"\n",(0,t.jsx)(i.p,{children:"Many 3D content tools have ways to generate lightmap textures. For example, 3ds Max, Maya, Blender and other tools all have ways to bake lightmaps into textures. The advantages of using an offline tool for lightmap generation is that you can use very sophisticated lighting calculations like Global Illumination for bounce lighting, soft shadows, ambient occlusion, etc. The major disadvantage is that you have to have a complete representation of your scene inside the 3D tool. So if your PlayCanvas scene is made up of lots of instances positioned in the Editor, you need to re-create this inside your lightmapping tool."}),"\n",(0,t.jsx)(i.p,{children:"Once you have created lightmaps using an external tool you simply upload them as regular texture assets and they can be added to your materials using the lightmap slot in the standard Physical Material."}),"\n",(0,t.jsx)(i.h2,{id:"tools",children:"Tools"}),"\n",(0,t.jsx)(i.p,{children:"In this page we will use 3ds Max with VRay to generate lightmaps, but the same functionality is achievable with any other similar modeling tools."}),"\n",(0,t.jsx)(i.h2,{id:"gamma-correction",children:"Gamma Correction"}),"\n",(0,t.jsx)(i.p,{children:"When rendering Lightmaps or CubeMaps they should be rendered in Linear Space to ensure color curves are not affected by gamma correction twice. The PlayCanvas Engine will apply gamma correction during real-time rendering."}),"\n",(0,t.jsx)(i.p,{children:"In 3ds Max this option (Enable Gamma/LUT Correction) should be disabled and can be found in Preference Settings (Customize > Preferences):"}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"/images/user-manual/graphics/lighting/lightmapping/3ds-max-preferences.png",alt:"3ds Max > Preferences > Linear Space"})}),"\n",(0,t.jsx)(i.p,{children:'Then make sure Color Mapping is updated. It can be found in Render Settings (F10, or from Render to Texture window). Output should not be clamped, and not post-processed (Mode option), Linear Multiply should be used for linear color space.\nHere is a screenshot of what options should be set to what values, click the "Default" button to expand settings to "Expert":'}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"/images/user-manual/graphics/lighting/lightmapping/3ds-max-render-settings-color-mapping.png",alt:"3D's Max > Render Settings"})}),"\n",(0,t.jsx)(i.h2,{id:"uv-mapping",children:"UV Mapping"}),"\n",(0,t.jsx)(i.p,{children:"In order to apply a lightmap texture on geometry we need to unwrap it first. Here are some practices that will help you to get good lightmap friendly UV's."}),"\n",(0,t.jsx)(i.h3,{id:"simple-geometry",children:"Simple Geometry"}),"\n",(0,t.jsx)(i.p,{children:"A smaller area of geometry is better. Try to minimize the area of triangles and eliminate non-visible triangles. A larger area will reduce lightmap detail, require larger textures and sometimes multiple assets."}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"/images/user-manual/graphics/lighting/lightmapping/uv-geometry.jpg",alt:"Lighmapping Tips: Simple Geometry"})}),"\n",(0,t.jsx)(i.h3,{id:"consistent-texel-size",children:"Consistent Texel Size"}),"\n",(0,t.jsx)(i.p,{children:"Keep texels in UV unstretched and consistent in size with other texels within same geometry. This is to ensure that level of detail in lightmap texture is consistent within the scene. Some variations of texel size could be applied when geometry will be seen from up close or in the far distance as required by artistic and optimization decisions."}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"/images/user-manual/graphics/lighting/lightmapping/uv-consistency.jpg",alt:"Lighmapping Tips: UV Consistent Texel Size"})}),"\n",(0,t.jsx)(i.h3,{id:"non-overlapping-uv",children:"Non-overlapping UV"}),"\n",(0,t.jsx)(i.p,{children:"Triangles in UV should not overlap to ensure each pixel has a unique position in 3D space on geometry so it can store its own illumination information appropriately. UV space for lightmaps is clamped, meaning that UV will be contained between 0.0 and 1.0 and will not tile outside."}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"/images/user-manual/graphics/lighting/lightmapping/uv-overlapping.jpg",alt:"Lighmapping Tips: Non-overlapping UV"})}),"\n",(0,t.jsx)(i.h2,{id:"other-tips",children:"Other Tips"}),"\n",(0,t.jsx)(i.p,{children:"To get good lightmap results we need to ensure that rendering is based only on data that is relevant to light propagation and not to the point of view of camera during rendering."}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Disable normal maps"})," on materials - micro surface details are too tiny to be relevant in lightmap textures."]}),"\n",(0,t.jsxs)(i.li,{children:["Set ",(0,t.jsx)(i.strong,{children:"Reflection to 0"})," and ",(0,t.jsx)(i.strong,{children:"Disable Gloss Maps"})," on materials - reflection can lead to caustics and complications for renderers, leading to visual artifacts. Generally lightmaps should contain only diffuse lighting and reflectivity should be implemented using some runtime technique."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Very dark materials won't produce good results"})," as they do not reflect light much and so will not assist Global Illumination."]}),"\n",(0,t.jsxs)(i.li,{children:["In the Render To Texture window (see below) set ",(0,t.jsx)(i.strong,{children:"Padding"})," to larger value."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Light can leak"})," from behind the geometry, add blocking geometry to prevent light."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"/images/user-manual/graphics/lighting/lightmapping/lightmapping-light-leak.jpg",alt:"Lighmapping Light Leaking"})}),"\n",(0,t.jsx)(i.h2,{id:"render-to-texture",children:"Render To Texture"}),"\n",(0,t.jsx)(i.p,{children:"To get illumination data out of the modeling tool we want to render the light data into a texture. We can specify resolution and format for it."}),"\n",(0,t.jsxs)(i.p,{children:["In 3ds Max this is done using the Render To Texture window. Where Padding needs to be set to larger value; selected 2nd UV Channel; and Output profile depending on your renderer, in screenshot below ",(0,t.jsx)(i.code,{children:"VRayRawTotalLightingMap"})," is used."]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"/images/user-manual/graphics/lighting/lightmapping/3ds-max-render-to-texture-window.png",alt:"Render To Texture: PlayCanvas Lightmapping"})}),"\n",(0,t.jsx)(i.h2,{id:"noise",children:"Noise"}),"\n",(0,t.jsx)(i.p,{children:"Depending on the quality and time of rendering in some situations the illumination data in the output might be not perfect and suffer from noise. This is easily solvable by applying some blur to the image that will not blur the edges in texture but will smoothen plain sections. In Photoshop this is done using Surface Blur filter:"}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"/images/user-manual/graphics/lighting/lightmapping/lightmapping-surface-blur.jpg",alt:"Lightmapping: Photoshop > Surface Blur"})}),"\n",(0,t.jsx)(i.h2,{id:"upload-to-editor",children:"Upload to Editor"}),"\n",(0,t.jsx)(i.p,{children:"At this stage you have your geometry with a second UV channel (UV1) and HDR lightmap textures and it is time to upload them to your PlayCanvas scene and setup the materials. This is done by drag 'n' dropping the files or using the upload button in assets panel. After you've uploaded your geometry it will auto-generate materials. For each material that a lightmap is rendered for you need to set the lightmap texture. Simply select all required materials and drag'n'drop or pick lightmap texture for the Lightmap slot."}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"/images/user-manual/graphics/lighting/lightmapping/lightmapping-material-slot.png",alt:"PlayCanvas Editor: Material Lightmap Texture Slot"})}),"\n",(0,t.jsx)(i.h2,{id:"final-remarks",children:"Final remarks"}),"\n",(0,t.jsx)(i.p,{children:"Gamma correction, tone mapping and exposure - are good settings that you will want to play with to get the desired look and color for your scene."}),"\n",(0,t.jsxs)(i.p,{children:["You can ",(0,t.jsx)(i.a,{href:"https://playcanv.as/p/zdkARz26/",children:"explore the example"})," that uses the techniques described above and also its ",(0,t.jsx)(i.a,{href:"https://playcanvas.com/project/446587/overview/archviz-example",children:"project"}),"."]})]})}function g(e={}){const{wrapper:i}={...(0,a.a)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(p,{...e})}):p(e)}},11151:(e,i,n)=>{n.d(i,{Z:()=>l,a:()=>r});var t=n(67294);const a={},s=t.createContext(a);function r(e){const i=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(s.Provider,{value:i},e.children)}}}]);