"use strict";(self.webpackChunkdeveloper_playcanvas_com=self.webpackChunkdeveloper_playcanvas_com||[]).push([[3918],{89657:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>l});var i=n(85893),r=n(11151);const s={title:"Migration Guide",sidebar_position:11},a=void 0,o={id:"user-manual/scripting/migration-guide",title:"Migration Guide",description:"Migrating Legacy Script Projects",source:"@site/docs/user-manual/scripting/migration-guide.md",sourceDirName:"user-manual/scripting",slug:"/user-manual/scripting/migration-guide",permalink:"/user-manual/scripting/migration-guide",draft:!1,unlisted:!1,editUrl:"https://github.com/playcanvas/developer.playcanvas.com/tree/dev/docs/user-manual/scripting/migration-guide.md",tags:[],version:"current",sidebarPosition:11,frontMatter:{title:"Migration Guide",sidebar_position:11},sidebar:"userManualSidebar",previous:{title:"Debugging",permalink:"/user-manual/scripting/debugging"},next:{title:"Templates",permalink:"/user-manual/templates/"}},c={},l=[{value:"Migrating Legacy Script Projects",id:"migrating-legacy-script-projects",level:2},{value:"Step 1 - Create a New Project",id:"step-1---create-a-new-project",level:3},{value:"Step 2 - Transfer Assets",id:"step-2---transfer-assets",level:3},{value:"Step 3 - Transfer Scripts",id:"step-3---transfer-scripts",level:3},{value:"Step 4 - Update Scripts to Current Format",id:"step-4---update-scripts-to-current-format",level:3},{value:"Migrating Script Events",id:"migrating-script-events",level:4},{value:"Step 5 - Transfer Scene Hierarchy",id:"step-5---transfer-scene-hierarchy",level:3}];function p(e){const t={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"migrating-legacy-script-projects",children:"Migrating Legacy Script Projects"}),"\n",(0,i.jsxs)(t.p,{children:["In July 2016, PlayCanvas adopted its ",(0,i.jsx)(t.a,{href:"https://blog.playcanvas.com/playcanvas-scripts-2-0/",children:"current scripting system"})," (sometimes known as Scripts 2.0). Legacy script projects continue to work as normal. However, it is no longer possible to fork or create new legacy script projects."]}),"\n",(0,i.jsx)(t.p,{children:"In December 2020, it was announced that legacy script projects would be made read-only in the near future. When you open one in the Editor, you will see the following message in the project dashboard:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"/images/user-manual/scripting/migration-guide/dashboard-warning.png",alt:"Dashboard Legacy Script"})}),"\n",(0,i.jsx)(t.p,{children:"And the following message in the Editor:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"/images/user-manual/scripting/migration-guide/editor-warning.png",alt:"Editor Legacy Script"})}),"\n",(0,i.jsx)(t.p,{children:"If you want to continue to work on legacy script projects, we recommend that you migrate them to the current format. Unfortunately, there is no automated migration process for this. Instead, it is a manual process, but this guide will walk you through it."}),"\n",(0,i.jsx)(t.h3,{id:"step-1---create-a-new-project",children:"Step 1 - Create a New Project"}),"\n",(0,i.jsx)(t.p,{children:"We will begin by creating a new, blank project to transfer assets and code into. Delete the four entities created by default below the scene root entity."}),"\n",(0,i.jsx)(t.h3,{id:"step-2---transfer-assets",children:"Step 2 - Transfer Assets"}),"\n",(0,i.jsxs)(t.p,{children:["Next, copy all assets to your new project (minus scripts which in legacy projects are ",(0,i.jsx)(t.em,{children:"not"})," true assets). It is possible to copy and paste assets from one project to another (using the right-click context menu)."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"/images/user-manual/scripting/migration-guide/copy-assets.png",alt:"Copy Paste Assets"})}),"\n",(0,i.jsx)(t.p,{children:"However, legacy script projects are quite old. Years ago, assets were imported without file extensions and some metadata might not be available to view in the Inspector panel. So you might want to consider downloading your source assets and uploading them to your new project."}),"\n",(0,i.jsx)(t.h3,{id:"step-3---transfer-scripts",children:"Step 3 - Transfer Scripts"}),"\n",(0,i.jsx)(t.p,{children:"Download the scripts from your legacy script project via the Project Dashboard:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"/images/user-manual/scripting/migration-guide/download-scripts.png",alt:"Download Scripts"})}),"\n",(0,i.jsx)(t.p,{children:"If your legacy project is connected to a GitHub repo, download your scripts from there."}),"\n",(0,i.jsx)(t.p,{children:"You can now upload the legacy scripts to your new project."}),"\n",(0,i.jsx)(t.h3,{id:"step-4---update-scripts-to-current-format",children:"Step 4 - Update Scripts to Current Format"}),"\n",(0,i.jsx)(t.p,{children:"The transferred scripts in your new project will now need to be updated to the current format. Here is an example, showing the legacy format:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"pc.script.attribute('speed', 'number', 10);\n\npc.script.create('myScript', function (app) {\n    // Creates a new MyScript instance\n    var MyScript = function (entity) {\n        this.entity = entity;\n    };\n\n    MyScript.prototype = {\n        // Called once after all resources are loaded and before the first update\n        initialize: function () {\n        },\n\n        // Called every frame, dt is time in seconds since last update\n        update: function (dt) {\n        }\n    };\n\n    return MyScript;\n});\n"})}),"\n",(0,i.jsx)(t.p,{children:"And here is the equivalent script in the current format:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"var MyScript = pc.createScript('myScript');\n\nMyScript.attributes.add('speed', { type: 'number', default: 10 });\n\n// initialize code called once per entity\nMyScript.prototype.initialize = function() {\n    var app = this.app;       // application instance is available as this.app\n    var entity = this.entity; // entity property already set up\n};\n\n// update code called every frame\nMyScript.prototype.update = function(dt) {\n};\n"})}),"\n",(0,i.jsx)(t.p,{children:"Things to notice:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["There is no constructor in the current script format. Constructor code must be moved to the ",(0,i.jsx)(t.code,{children:"initialize"})," function."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"app"})," (the ",(0,i.jsx)(t.code,{children:"pc.Application"})," instance of the script) becomes ",(0,i.jsx)(t.code,{children:"this.app"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"this.entity"})," is automatically made available to current format scripts."]}),"\n"]}),"\n",(0,i.jsx)(t.h4,{id:"migrating-script-events",children:"Migrating Script Events"}),"\n",(0,i.jsxs)(t.p,{children:["Legacy scripts handle events like ",(0,i.jsx)(t.code,{children:"enable"}),", ",(0,i.jsx)(t.code,{children:"disable"})," and ",(0,i.jsx)(t.code,{children:"destroy"})," as follows:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"onEnable: function () {\n\n},\n\nonDisable: function () {\n\n},\n\nonDestroy: function () {\n\n},\n"})}),"\n",(0,i.jsxs)(t.p,{children:["To migrate these to the current script format, you would register event handlers in the script's ",(0,i.jsx)(t.code,{children:"initialize"})," function:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:'MyScript.prototype.initialize = function() {\n    this.on("enable", function () {\n\n    });\n\n    this.on("disable", function () {\n\n    });\n\n    this.on("destroy", function () {\n\n    });\n};\n'})}),"\n",(0,i.jsx)(t.h3,{id:"step-5---transfer-scene-hierarchy",children:"Step 5 - Transfer Scene Hierarchy"}),"\n",(0,i.jsx)(t.p,{children:"Next, we will transfer the legacy project's scene hierarchy across. The PlayCanvas Editor supports a copy and paste operation between two Editor instances. However, this operation fails if legacy script components are in the selection. Therefore, you should first delete all script components from your legacy script project. To do this, select all entities with legacy script components. You can do this by running the following JavaScript in the browser's JavaScript console:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"var entities = editor.call('entities:list').filter(function(entity) {\n    return entity.has('components.script');\n});\nif (entities.length) {\n    editor.call('selector:set', 'entity', entities);\n} else {\n    editor.call('selector:clear');\n}\n"})}),"\n",(0,i.jsx)(t.p,{children:"You should see something like the following:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"/images/user-manual/scripting/migration-guide/select-script-entities.png",alt:"Select Script Entities"})}),"\n",(0,i.jsx)(t.p,{children:"You can then hit the delete button in the Inspector:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"/images/user-manual/scripting/migration-guide/delete-script-components.png",alt:"Delete Script Components"})}),"\n",(0,i.jsx)(t.p,{children:"Now you can successfully copy and paste your game's hierarchy from the read-only project to the new destination project."}),"\n",(0,i.jsx)(t.p,{children:"With this done, you can hit CTRL+Z (CMD+Z on Mac) to undo the previous deletion of your legacy script components."}),"\n",(0,i.jsx)(t.p,{children:"Reselect all entities that have a script component. Create a script component on every corresponding entity in the new project and add the corresponding scripts to those components. Finally, iterate through every script attribute on every script on every script component and copy its value over to the new project."}),"\n",(0,i.jsx)(t.p,{children:"You should now be done with the migration."})]})}function d(e={}){const{wrapper:t}={...(0,r.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},11151:(e,t,n)=>{n.d(t,{Z:()=>o,a:()=>a});var i=n(67294);const r={},s=i.createContext(r);function a(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);